upstream  {{project_name}}_upstream {
    server unix:/home/projects/{{project_name}}/{{project_name}}/tmp/gunicorn.sock fail_timeout=0;
}

server {
    listen 80;
    server_name {{project_name}}.cruncher.ch;
    proxy_set_header X-Forwarded-Protocol http;
    access_log  /var/log/nginx/{{project_name}}.access.log;
    charset utf-8;
    server_tokens off;

    gzip  on;
    gzip_comp_level 2;
    gzip_proxied any;
    gzip_types      text/plain text/html text/css text/javascript application/x-javascript font/ttf font/otf image/svg+xml;
    
    client_max_body_size 100M;
    root /home/projects/{{project_name}}/{{project_name}}/docroot;
    location /static/ {
	   root /home/projects/{{project_name}}/{{project_name}}/tmp;
    }
    location /media/ {
	root /home/projects/{{project_name}}/{{project_name}}/tmp;
    }
    location / {

        # auth_basic "Restricted Zone";
        # auth_basic_user_file /home/projects/{{project_name}}/{{project_name}}/conf/prod/htpasswd.conf;

        proxy_pass_header Server;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Scheme $scheme;
        proxy_connect_timeout 10;
        proxy_read_timeout 10;
        proxy_pass http://{{project_name}}_upstream;
    }
}
